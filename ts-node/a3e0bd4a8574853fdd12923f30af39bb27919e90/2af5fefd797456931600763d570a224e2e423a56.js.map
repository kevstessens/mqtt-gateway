{"version":3,"file":"/root/code/mqtt-gateway/app/security/verify_token.ts","sources":["/root/code/mqtt-gateway/app/security/verify_token.ts"],"names":[],"mappings":";AAAA,oCAAsC;AACtC,+BAA0B;AAC1B,kCAAoC;AACpC,oCAAgC;AAEhC,IAAI,GAAG,GAAG,kBAAS,GAAG,iBAAiB,CAAC;AAExC,eAAe,IAAI;IACf,YAAG,CAAC,8BAA8B,GAAG,GAAG,CAAC,CAAC;IAC1C,MAAM,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;AACzC,CAAC;AAED,YAAY,KAAK;IACb,YAAG,CAAC,sCAAsC,GAAG,GAAG,CAAC,CAAC;IAClD,YAAG,CAAC,6BAA6B,CAAC,CAAC;IACnC,OAAO,CAAC,IAAI,EAAE,CAAC;AACnB,CAAC;AAED,IAAI,cAAc,GAAG,eAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;AAEpD,qBAA4B,KAAK;IAC7B,YAAY,KAAK;QACb,YAAG,CAAC,yBAAyB,GAAG,GAAG,CAAC,CAAC;IACzC,CAAC;IAED,YAAY,IAAI;QACZ,YAAG,CAAC,4DAA4D,CAAC,CAAC;QAClE,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE,UAAU,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;IAC9D,CAAC;IACD,YAAG,CAAC,2BAA2B,CAAC,CAAC;IACjC,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;AACvC,CAAC;AAXD,kCAWC;AAAA,CAAC","sourcesContent":["import { webAppUrl } from \"../config\";\nimport Axios from \"axios\";\nimport * as jwt from \"jsonwebtoken\";\nimport { log } from \"../logger\";\n\nlet url = webAppUrl + \"/api/public_key\";\n\nfunction keyOk(resp) {\n    log(\"Downloaded certificate from \" + url);\n    return new Buffer(resp.data, \"utf8\");\n}\n\nfunction no(error) {\n    log(\"Unable to download certificate from \" + url);\n    log(\"Is the FarmBot API running?\");\n    process.exit();\n}\n\nlet getCertificate = Axios.get(url).then(keyOk, no);\n\nexport function verifyToken(token) {\n    function no(error) {\n        log(\"Unable to verify token \" + url);\n    }\n\n    function ok(cert) {\n        log(\"Did fetch certificate. Will verify token with certificate.\");\n        return jwt.verify(token, cert, { algorithms: [\"RS256\"] });\n    }\n    log(\"Will fetch certificate...\");\n    return getCertificate.then(ok, no);\n};\n"]}