{"version":3,"file":"/root/code/mqtt-gateway/app/config.ts","sources":["/root/code/mqtt-gateway/app/config.ts"],"names":[],"mappings":";AAAA,mCAA+B;AAGpB,QAAA,SAAS,GAAG,OAAO,CAAC,GAAG,CAAC,WAAW,IAAI,uBAAuB,CAAC;AAC1E,YAAG,CAAC,WAAS,iBAAS,gBAAa,CAAC,CAAC;AAErC,wBAA+B,SAAc;IAAd,0BAAA,EAAA,cAAc;IACzC,IAAM,OAAO,GAAG,2BAAyB,SAAS,MAAG,CAAC;IAEtD,IAAI,MAAM,GAAe;QACrB,cAAc,EAAE,IAAI;QACpB,IAAI,EAAE,IAAI;QACV,IAAI,EAAE;YACF,IAAI,EAAE,IAAI;YACV,MAAM,EAAE,IAAI;YACZ,MAAM,EAAE,UAAU;SACrB;QACD,KAAK,EAAE;YACH,IAAI,EAAE,GAAG;SACZ;QACD,MAAM,EAAE;YACJ,IAAI,EAAE,IAAI;YACV,OAAO,EAAE,OAAO,GAAG,aAAa;YAChC,QAAQ,EAAE,OAAO,GAAG,UAAU;SACjC;KACJ,CAAC;IAEF,oCAAoC;IACpC,eAAe;IACf,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;QACb,OAAO,MAAM,CAAC,KAAK,CAAC;QACpB,OAAO,MAAM,CAAC,MAAM,CAAC;IACzB,CAAC;IAED,MAAM,CAAC,MAAM,CAAC;AAClB,CAAC;AA7BD,wCA6BC","sourcesContent":["import { log } from \"./logger\";\nimport { ServerOpts } from \"mosca\";\n\nexport let webAppUrl = process.env.WEB_API_URL || \"http://localhost:3000\";\nlog(`Using ${webAppUrl} as API URL`);\n\nexport function generateConfig(sslDomain = \"\") {\n    const SSL_DIR = `/etc/letsencrypt/live/${sslDomain}/`;\n\n    let config: ServerOpts = {\n        allowNonSecure: true,\n        port: 1883,\n        http: { // for teh websockets\n            port: 3002,\n            bundle: true,\n            static: \"./public\"\n        },\n        https: {\n            port: 443\n        },\n        secure: {\n            port: 8883,\n            keyPath: SSL_DIR + \"privkey.pem\",\n            certPath: SSL_DIR + \"cert.pem\"\n        }\n    };\n\n    // Remove SSL features if SSL_DOMAIN\n    // was not set.\n    if (!sslDomain) {\n        delete config.https;\n        delete config.secure;\n    }\n\n    return config;\n}\n"]}